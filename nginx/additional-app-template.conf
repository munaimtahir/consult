# Template for adding additional apps to nginx configuration
# 
# This is a reference template for adding new applications to the nginx reverse proxy.
# Copy and modify this template when adding a new application to the deployment.
#
# Instructions:
# 1. Replace 'app2' with your application name throughout
# 2. Update the upstream server addresses to match your app's backend/frontend
# 3. Adjust the location paths to match your app's routing structure
# 4. Add rate limiting zones if needed
# 5. Copy the modified configuration into nginx/default.conf

# Example Upstream Definitions
upstream app2_backend {
    server app2_backend:8000 max_fails=3 fail_timeout=30s;
}

upstream app2_frontend {
    server app2_frontend:80 max_fails=3 fail_timeout=30s;
}

# Example Rate Limiting Zone (add to http level in default.conf)
# limit_req_zone $binary_remote_addr zone=app2_api_limit:10m rate=100r/m;

# Example Server Block
server {
    listen 80;
    server_name _;
    
    # App2 - API endpoints
    location /app2/api/ {
        limit_req zone=app2_api_limit burst=20 nodelay;
        proxy_pass http://app2_backend;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_set_header X-Forwarded-Host $host;
        proxy_set_header X-Forwarded-Port $server_port;
    }
    
    # App2 - Admin panel
    location /app2/admin/ {
        proxy_pass http://app2_backend;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
    
    # App2 - Frontend
    location /app2/ {
        proxy_pass http://app2_frontend;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
}
